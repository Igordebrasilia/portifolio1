function init(){const t=document.querySelectorAll("#widget-vs");t.length&&t.forEach(t=>{const e=t.querySelector("script"),n=JSON.parse(e.innerText);n.endpoint&&initVSWidget(n.endpoint,t,n)})}function initVSWidget(t,e,n){getStories(t,function(t){createPlayerDom(t,e,n)})}function getStories(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&n.responseText&&e(JSON.parse(n.responseText))},n.open("GET",t,!0),n.send(null)}function createPlayerDom(t,e,n){const r=document.createElement("amp-story-player");r.setAttribute("class","sty-player"),r.setAttribute("amp-cache","cdn.ampproject.org"),addPlayerConfig(r);const s=Object.assign({klasses:{crc:"wdg-circular wdg-sm"},title:!0},n.styles?n.styles:{}),a=e,c=document.createElement("div");c.setAttribute("class","wdg-container"),a.append(c);const o=document.createElement("div");o.setAttribute("class","lightbox"),a.append(o);const i=document.createElement("div");i.setAttribute("class",s.klasses.crc);const l=document.createElement("div");l.setAttribute("class","wdg-holder"),i.append(l),addNavBtns(i),t.forEach(t=>{const e=document.createElement("a");e.href=t.href,r.append(e),addCardToCarousel(l,t,s)}),o.append(r),addPlayerScript(),subscribeToPlayer(r,o,c,i,a)}function addNavBtns(t){const e=document.createElement("div");e.setAttribute("class","arw-wpr"),e.setAttribute("id","arrows");const n=document.createElement("button");n.setAttribute("class","wdg-arrow-left wdg-arrow"),n.setAttribute("title","previous"),n.style.opacity="1";const r=document.createElement("button");r.setAttribute("class","wdg-arrow-right wdg-arrow"),r.setAttribute("title","next"),r.style.opacity="1",e.append(n),e.append(r),t.append(e)}function addPlayerConfig(t){const e=document.createElement("script");e.setAttribute("type","application/json"),e.innerHTML='{\n    "controls": [\n      {\n        "name": "close",\n        "position": "end"\n      }\n    ]\n    ,"display": {\n        "attribution": "auto"\n      }\n  }',t.append(e)}function addCardToCarousel(t,e,n){const r=document.createElement("div");r.setAttribute("class","wdg-content");const s=document.createElement("div");s.setAttribute("class","bg bg-grad"),n.imgbg&&s.setAttribute("style","background:"+n.imgbg);const a=document.createElement("img");if(a.setAttribute("class","wdg-content-img"),a.setAttribute("src",e.posterImage),s.append(a),r.append(s),n.title){const t=document.createElement("span");t.setAttribute("class","wdg-content-title"),n.ttlclr&&t.setAttribute("style","color:"+n.ttlclr),t.innerHTML=e.title;const s=document.createElement("div");s.setAttribute("class","wdg-card-title wdg-text"),s.append(t),r.append(s)}t.append(r)}function subscribeToPlayer(t,e,n,r,s){let a=0;t.addEventListener("ready",()=>{1===++a&&(appendCarousel(n,r),initializeCards(t,t.getStories(),s))}),t.isReady&&1===++a&&(appendCarousel(n,r),initializeCards(t,t.getStories(),s)),t.addEventListener("amp-story-player-close",t=>{e.classList.toggle("show")})}function appendCarousel(t,e){t.append(e)}function initializeCards(t,e,n){const r=n.querySelector(".lightbox"),s=n.querySelectorAll(".wdg-content"),a=parseFloat(getComputedStyle(s[0]).marginRight)+parseFloat(getComputedStyle(s[0]).marginLeft)+s[0].offsetWidth;s.forEach((n,s)=>{n.addEventListener("click",()=>{t.show(e[s].href),r.classList.toggle("show")})}),initializeArrows(s,a,n)}function initializeArrows(t,e,n){const r=n.querySelector(".wdg-holder"),s=n.querySelector(".wdg-arrow-left"),a=n.querySelector(".wdg-arrow-right"),c=r.clientWidth-t.length*e;r.clientWidth>=t.length*e&&(document.getElementById("arrows").style.display="none"),c>=0||(addClickListener(s,c,t,e,!0),addClickListener(a,c,t,e))}function addClickListener(t,e,n,r,s=!1){scrollX=0,t.addEventListener("click",()=>{scrollX=s?Math.min(0,scrollX+2*r):Math.max(e,scrollX-2*r);for(let t=0;t<n.length;t++)n[t].style.transform=`translateX(${scrollX}px)`})}function addPlayerScript(){const t="https://cdn.ampproject.org/amp-story-player-v0.js";if(document.querySelector('script[src="'+t+'"]'))return;const e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,document.head.appendChild(e)}document.addEventListener("DOMContentLoaded",function(){init()});